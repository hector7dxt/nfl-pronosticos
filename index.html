<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pronósticos NFL</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){
      emailjs.init("bN1z0hPEzhuurAXga"); // Public Key de EmailJS
    })();
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 20px;
      color: #1f2937;
    }
    
    /* Contenedor principal para el formulario y resultados */
    .contenedor-principal {
        display: flex;
        justify-content: center;
        width: 100%;
        max-width: 1200px; 
        gap: 20px; 
    }
    
    .formulario {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      width: 100%;
      max-width: 700px; 
      margin-top: 15px;
    }
    
    /* Contenedor de la derecha: Resultados por Semana + Tabla de Récords */
    .contenedor-derecha {
        width: 100%;
        max-width: 500px;
        margin-top: 15px;
        display: flex;
        flex-direction: column;
        gap: 20px; 
    }

    /* Estilo general para las cajas de la derecha */
    .resultados-box, .records-box {
        background: white;
        padding: 15px; 
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        height: fit-content; 
    }

    .records-box h2 {
        color: #059669; 
        margin-top: 0;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 8px; 
        margin-bottom: 15px; 
        font-size: 1.2em;
    }
    
    .selector-resultados-container {
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin-bottom: 15px;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 10px;
    }
    
    .partido-resultado {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 0; 
        border-bottom: 1px solid #eee;
        font-size: 0.9em; 
    }
    
    .partido-resultado:last-child {
        border-bottom: none;
    }
    
    .equipo-res {
        font-weight: bold;
        display: flex;
        align-items: center;
    }
    
    .score {
        font-weight: bold;
        color: #1f2937;
        width: 25px; 
        text-align: center;
    }
    
    .vs-res {
        margin: 0 5px; 
        color: #6b7280;
    }
    
    .logo-res {
        width: 20px; 
        height: 20px;
        margin: 0 4px; 
    }

    /* Estilos para la tabla de rendimiento (G-P) */
    .records-table {
        width: 100%;
        border-collapse: collapse;
    }
    .records-table th, .records-table td {
        padding: 8px;
        border: 1px solid #ddd;
        text-align: center;
    }
    .records-table th {
        background: #e5e7eb;
        font-weight: bold;
    }
    .records-table td:first-child {
        text-align: left;
    }


    /* Estilos del campo de nombre y el botón de envío */
    .input-nombre-container {
        width: 100%;
        max-width: 700px;
        margin: 15px auto 0 auto;
        padding: 0 20px; 
    }

    .input-nombre {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-sizing: border-box; 
    }
    
    button#enviarBtn {
      width: 100%;
      padding: 10px;
      background: #2563eb;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 0; 
      max-width: 700px;
    }
    button#enviarBtn:hover {
      background: #1d4ed8;
    }

    /* Estilos del formulario (optimizados) */
    .partido {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px; 
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 8px; 
      background: #fafafa;
    }
    .equipo {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      width: 45%;
      font-size: 0.9em; 
    }
    .equipo input {
      margin-bottom: 3px; 
    }
    .equipo img {
      width: 45px; 
      height: 45px;
    }
    
    /* Media Query para pantallas pequeñas */
    @media (max-width: 900px) {
        .contenedor-principal {
            flex-direction: column; 
            gap: 0;
        }
        .contenedor-derecha {
            max-width: 700px;
            width: 100%;
            margin-bottom: 15px;
            order: -1; 
        }
        .formulario {
            margin-top: 0;
        }
        .input-nombre-container {
            padding: 0 15px; 
        }
    }
  </style>
</head>
<body>
  <h1>Pronósticos NFL</h1>

  <label><strong>Selecciona semana (Pronósticos): Se cierra Jueves a medio dia</strong></label> <br>
  <label><strong><a href="https://hector7dxt.github.io/tabgoogle.html">Enlace a hoja de pronóstico </a></strong></label> <br>
  <select id="semanaSelect" onchange="cargarSemana()"> 
    <option value="1">Semana 1 CERRADA</option>
    <option value="2">Semana 2 CERRADA</option>
    <option value="3">Semana 3 CERRADA</option>
    <option value="4">Semana 4 CERRADA</option>
    <option value="5">Semana 5 EN CURSO</option>
  </select>
  
  <div class="contenedor-principal">
      
      <div class="contenedor-derecha">
          
          <div class="resultados-box">
              <div class="selector-resultados-container">
                  <label><strong>Resultados de la Semana: Se actualiza el Martes</strong></label>
                  <select id="resultadosSelect" onchange="cargarResultados()"> 
                    <option value="1">Semana 1</option>
                    <option value="2">Semana 2</option>
                    <option value="3">Semana 3</option>
                    <option value="4">Semana 4</option>
                    <option value="5">Semana 5</option>
                  </select>
              </div>
              <div id="resultadosList">
                  </div>
          </div>
          
          <div class="records-box">
              <h2>Récord General (Ganados-Perdidos)</h2>
              <table class="records-table">
                  <thead>
                      <tr>
                          <th>Equipo</th>
                          <th>G</th>
                          <th>P</th>
                      </tr>
                  </thead>
                  <tbody id="recordsTableBody">
                      </tbody>
              </table>
          </div>

      </div>

      <div class="formulario" id="formulario"></div>
      
  </div>

  <div class="input-nombre-container">
    <label for="nombreUsuario"><strong>Tu Nombre:</strong></label>
    <input type="text" id="nombreUsuario" class="input-nombre" required placeholder="Introduce tu nombre aquí">
    <button id="enviarBtn" onclick="guardarPronosticos()">Enviar Pronósticos</button>
  </div>


  <table id="tablaPronosticos" style="display:none;">
    <thead>
      <tr>
        <th>Partido</th>
        <th>Equipo Seleccionado</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const logos = {
  Cowboys: "https://a.espncdn.com/i/teamlogos/nfl/500/dal.png",
  "49ers": "https://a.espncdn.com/i/teamlogos/nfl/500/sf.png",
  Chiefs: "https://a.espncdn.com/i/teamlogos/nfl/500/kc.png",
  Eagles: "https://a.espncdn.com/i/teamlogos/nfl/500/phi.png",
  Packers: "https://a.espncdn.com/i/teamlogos/nfl/500/gb.png",
  Patriots: "https://a.espncdn.com/i/teamlogos/nfl/500/ne.png",
  Steelers: "https://a.espncdn.com/i/teamlogos/nfl/500/pit.png",
  Ravens: "https://a.espncdn.com/i/teamlogos/nfl/500/bal.png",
  Seahawks: "https://a.espncdn.com/i/teamlogos/nfl/500/sea.png",
  Dolphins: "https://a.espncdn.com/i/teamlogos/nfl/500/mia.png",
  Giants: "https://a.espncdn.com/i/teamlogos/nfl/500/nyg.png",
  Jets: "https://a.espncdn.com/i/teamlogos/nfl/500/nyj.png",
  Bears: "https://a.espncdn.com/i/teamlogos/nfl/500/chi.png",
  Lions: "https://a.espncdn.com/i/teamlogos/nfl/500/det.png",
  Vikings: "https://a.espncdn.com/i/teamlogos/nfl/500/min.png",
  Saints: "https://a.espncdn.com/i/teamlogos/nfl/500/no.png",
  Buccaneers: "https://a.espncdn.com/i/teamlogos/nfl/500/tb.png",
  Rams: "https://a.espncdn.com/i/teamlogos/nfl/500/lar.png",
  Chargers: "https://a.espncdn.com/i/teamlogos/nfl/500/lac.png",
  Raiders: "https://a.espncdn.com/i/teamlogos/nfl/500/lv.png",
  Bills: "https://a.espncdn.com/i/teamlogos/nfl/500/buf.png",
  Bengals: "https://a.espncdn.com/i/teamlogos/nfl/500/cin.png",
  Browns: "https://a.espncdn.com/i/teamlogos/nfl/500/cle.png",
  Texans: "https://a.espncdn.com/i/teamlogos/nfl/500/hou.png",
  Colts: "https://a.espncdn.com/i/teamlogos/nfl/500/ind.png",
  Jaguars: "https://a.espncdn.com/i/teamlogos/nfl/500/jax.png",
  Titans: "https://a.espncdn.com/i/teamlogos/nfl/500/ten.png",
  Broncos: "https://a.espncdn.com/i/teamlogos/nfl/500/den.png",
  Commanders: "https://a.espncdn.com/i/teamlogos/nfl/500/wsh.png",
  Panthers: "https://a.espncdn.com/i/teamlogos/nfl/500/car.png",
  Falcons: "https://a.espncdn.com/i/teamlogos/nfl/500/atl.png",
  Cardinals: "https://a.espncdn.com/i/teamlogos/nfl/500/ari.png"
};

    const semanas = {
      1: [
        ["Cowboys", "Eagles"],
        ["Chiefs", "Chargers"],
        ["Buccaneers", "Falcons"],
        ["Bengals", "Browns"],
        ["Dolphins", "Colts"],
        ["Panthers", "Jaguars"],
        ["Patriots", "Raiders"],
        ["Saints", "Cardinals"],
        ["Jets", "Steelers"],
        ["Commanders", "Giants"],
        ["Titans", "Broncos"],
        ["49ers", "Seahawks"],
        ["Packers", "Lions"],
        ["Texans", "Rams"],
        ["Bills", "Ravens"],
        ["Bears", "Vikings"],
        ],
      2: [
  ["Packers", "Commanders"],            
  ["Ravens", "Browns"],          
  ["Bengals", "Jaguars"],       
  ["Cowboys", "Giants"],          
  ["Lions", "Bears"],          
  ["Dolphins", "Patriots"],         
  ["Saints", "49ers"],        
  ["Jets", "Bills"],        
  ["Steelers", "Seahawks"],       
  ["Titans", "Rams"],           
  ["Cardinals", "Panthers"],         
  ["Colts", "Broncos"],           
  ["Chiefs", "Eagles"],             
  ["Vikings", "Falcons"],            
  ["Texans", "Buccaneers"],            
  ["Raiders", "Chargers"]            
],
      3: [
  ["Bills", "Dolphins"],
  ["Panthers", "Falcons"],
  ["Browns", "Packers"],
  ["Jaguars", "Texans"],
  ["Vikings", "Bengals"],
  ["Patriots", "Steelers"],
  ["Eagles", "Rams"],
  ["Buccaneers", "Jets"],
  ["Titans", "Colts"],
  ["Commanders", "Raiders"],
  ["Chargers", "Broncos"],
  ["Seahawks", "Saints"],
  ["Bears", "Cowboys"],
  ["Cardinals", "49ers"],
  ["Giants", "Chiefs"],
  ["Ravens", "Lions"]
],
4: [
  ["Seahawks", "Cardinals"],
  ["Vikings", "Steelers"],
  ["Commanders", "Falcons"],
  ["Saints", "Bills"],
  ["Browns", "Lions"],
  ["Titans", "Texans"],
  ["Panthers", "Patriots"],
  ["Chargers", "Giants"],
  ["Eagles", "Buccaneers"],
  ["Colts", "Rams"],
  ["Jaguars", "49ers"],
  ["Ravens", "Chiefs"],
  ["Bears", "Raiders"],
  ["Packers", "Cowboys"],
  ["Jets", "Dolphins"],
  ["Bengals", "Broncos"]
],
5: [
   ["Rams", "49ers"],             
  ["Browns", "Vikings"],         
  ["Eagles", "Broncos"],         
  ["Jets", "Cowboys"],           
  ["Colts", "Raiders"],          
  ["Panthers", "Dolphins"],      
  ["Saints", "Giants"],          
  ["Ravens", "Texans"],          
  ["Seahawks", "Buccaneers"],    
  ["Cardinals", "Titans"],       
  ["Chargers", "Commanders"],    
  ["Bengals", "Lions"],          
  ["Bills", "Patriots"],         
  ["Jaguars", "Chiefs"]        
]
    };

    const resultados = {
        1: [
        { equipo1: "Cowboys", score1: 20, equipo2: "Eagles", score2: 24 },
        { equipo1: "Chiefs", score1: 21, equipo2: "Chargers", score2: 27 },
        { equipo1: "Buccaneers", score1: 23, equipo2: "Falcons", score2: 20 },
        { equipo1: "Bengals", score1: 17, equipo2: "Browns", score2: 16 },
        { equipo1: "Dolphins", score1: 8, equipo2: "Colts", score2: 33 },
        { equipo1: "Panthers", score1: 26, equipo2: "Jaguars", score2: 10 },
        { equipo1: "Patriots", score1: 13, equipo2: "Raiders", score2: 20 },
        { equipo1: "Saints", score1: 13, equipo2: "Cardinals", score2: 20 },
        { equipo1: "Jets", score1: 32, equipo2: "Steelers", score2: 34 },
        { equipo1: "Commanders", score1: 21, equipo2: "Giants", score2: 6 },
        { equipo1: "Titans", score1: 12, equipo2: "Broncos", score2: 20 },
        { equipo1: "49ers", score1: 17, equipo2: "Seahawks", score2: 13 },
        { equipo1: "Packers", score1: 27, equipo2: "Lions", score2: 13 },
        { equipo1: "Texans", score1: 9, equipo2: "Rams", score2: 14 },
        { equipo1: "Bills", score1: 41, equipo2: "Ravens", score2: 40 },
        { equipo1: "Bears", score1: 24, equipo2: "Vikings", score2: 27 },
        ],
        2: [
            { equipo1: "Packers", score1: 27, equipo2: "Commanders", score2: 18 },
            { equipo1: "Ravens", score1: 41, equipo2: "Browns", score2: 17 },
            { equipo1: "Bengals", score1: 31, equipo2: "Jaguars", score2: 27 },
            { equipo1: "Cowboys", score1: 40, equipo2: "Giants", score2: 37 },
            { equipo1: "Lions", score1: 52, equipo2: "Bears", score2: 21 },
            { equipo1: "Dolphins", score1: 27, equipo2: "Patriots", score2: 33 },
            { equipo1: "Saints", score1: 21, equipo2: "49ers", score2: 26 },
            { equipo1: "Jets", score1: 10, equipo2: "Bills", score2: 30 },
            { equipo1: "Steelers", score1: 17, equipo2: "Seahawks", score2: 31 },
            { equipo1: "Titans", score1: 19, equipo2: "Rams", score2: 33 },
            { equipo1: "Cardinals", score1: 27, equipo2: "Panthers", score2: 22 },
            { equipo1: "Colts", score1: 29, equipo2: "Broncos", score2: 28 },
            { equipo1: "Chiefs", score1: 17, equipo2: "Eagles", score2: 20 },
            { equipo1: "Vikings", score1: 6, equipo2: "Falcons", score2: 22 },
            { equipo1: "Texans", score1: 19, equipo2: "Buccaneers", score2: 20 },
            { equipo1: "Raiders", score1: 9, equipo2: "Chargers", score2: 20 },
          ],
        3: [
            { equipo1: "Bills", score1: 31, equipo2: "Dolphins", score2: 21 },
            { equipo1: "Panthers", score1: 30, equipo2: "Falcons", score2: 0 },
            { equipo1: "Browns", score1: 13, equipo2: "Packers", score2: 10 },
            { equipo1: "Jaguars", score1: 17, equipo2: "Texans", score2: 10 },
            { equipo1: "Vikings", score1: 48, equipo2: "Bengals", score2: 10 },
            { equipo1: "Patriots", score1: 14, equipo2: "Steelers", score2: 21 },
            { equipo1: "Eagles", score1: 33, equipo2: "Rams", score2: 26 },
            { equipo1: "Buccaneers", score1: 29, equipo2: "Jets", score2: 27 },
            { equipo1: "Titans", score1: 20, equipo2: "Colts", score2: 41 },
            { equipo1: "Commanders", score1: 41, equipo2: "Raiders", score2: 24 },
            { equipo1: "Chargers", score1: 23, equipo2: "Broncos", score2: 20 },
            { equipo1: "Seahawks", score1: 44, equipo2: "Saints", score2: 13 },
            { equipo1: "Bears", score1: 31, equipo2: "Cowboys", score2: 14 },
            { equipo1: "Cardinals", score1: 16, equipo2: "49ers", score2: 15 },
            { equipo1: "Giants", score1: 9, equipo2: "Chiefs", score2: 22 },
            { equipo1: "Ravens", score1: 30, equipo2: "Lions", score2: 38 },
          ],
          4: [
            { equipo1: "Seahawks", score1: 23, equipo2: "Cardinals", score2: 20 },
            { equipo1: "Vikings", score1: 21, equipo2: "Steelers", score2: 24 },
            { equipo1: "Commanders", score1: 27, equipo2: "Falcons", score2: 34 },
            { equipo1: "Saints", score1: 19, equipo2: "Bills", score2: 31 },
            { equipo1: "Browns", score1: 10, equipo2: "Lions", score2: 34 },
            { equipo1: "Titans", score1: 0, equipo2: "Texans", score2: 26 },
            { equipo1: "Panthers", score1: 13, equipo2: "Patriots", score2: 42 },
            { equipo1: "Chargers", score1: 18, equipo2: "Giants", score2: 21 },
            { equipo1: "Eagles", score1: 31, equipo2: "Buccaneers", score2: 25 },
            { equipo1: "Colts", score1: 20, equipo2: "Rams", score2: 27 },
            { equipo1: "Jaguars", score1: 26, equipo2: "49ers", score2: 21 },
            { equipo1: "Ravens", score1: 20, equipo2: "Chiefs", score2: 37 },
            { equipo1: "Bears", score1: 25, equipo2: "Raiders", score2: 24 },
            { equipo1: "Packers", score1: 40, equipo2: "Cowboys", score2: 40 },
            { equipo1: "Jets", score1: 21, equipo2: "Dolphins", score2: 27 },
            { equipo1: "Bengals", score1: 3, equipo2: "Broncos", score2: 28 },
          ],
          5: [
            { equipo1: "Rams", score1: 00, equipo2: "49ers", score2: 00 },
            { equipo1: "Browns", score1: 00, equipo2: "Vikings", score2: 00 },
            { equipo1: "Eagles", score1: 00, equipo2: "Broncos", score2: 00 },
            { equipo1: "Jets", score1: 00, equipo2: "Cowboys", score2: 00 },
            { equipo1: "Colts", score1: 00, equipo2: "Raiders", score2: 00 },
            { equipo1: "Panthers", score1: 00, equipo2: "Dolphins", score2: 00 },
            { equipo1: "Saints", score1: 00, equipo2: "Giants", score2: 00 },
            { equipo1: "Ravens", score1: 00, equipo2: "Texans", score2: 00 },
            { equipo1: "Seahawks", score1: 00, equipo2: "Buccaneers", score2: 00 },
            { equipo1: "Cardinals", score1: 00, equipo2: "Titans", score2: 00 },
            { equipo1: "Chargers", score1: 00, equipo2: "Commanders", score2: 00 },
            { equipo1: "Bengals", score1: 00, equipo2: "Lions", score2: 00 },
            { equipo1: "Bills", score1: 00, equipo2: "Patriots", score2: 00 },
            { equipo1: "Jaguars", score1: 00, equipo2: "Chiefs", score2: 00 },
          ]
    };

    const formulario = document.getElementById("formulario");
    const resultadosList = document.getElementById("resultadosList");
    const recordsTableBody = document.getElementById("recordsTableBody");
    const resultadosSelect = document.getElementById("resultadosSelect");
    const nombreUsuarioInput = document.getElementById("nombreUsuario");

    function cargarSemana() {
      const semanaSeleccionada = document.getElementById("semanaSelect").value;
      formulario.innerHTML = "";
      
      const partidos = semanas[semanaSeleccionada];
      partidos.forEach((par, i) => {
        const [equipo1, equipo2] = par;
        const partidoId = `sem${semanaSeleccionada}_partido${i + 1}`;

        const partidoDiv = document.createElement("div");
        partidoDiv.classList.add("partido");
        partidoDiv.innerHTML = `
          <label class="equipo">
            <input type="radio" name="${partidoId}" value="${equipo1}">
            <img src="${logos[equipo1]}" alt="${equipo1}">
            <div>${equipo1}</div>
          </label>
          <span>VS</span>
          <label class="equipo">
            <input type="radio" name="${partidoId}" value="${equipo2}">
            <img src="${logos[equipo2]}" alt="${equipo2}">
            <div>${equipo2}</div>
          </label>
        `;
        formulario.appendChild(partidoDiv);
      });
    }

    function cargarResultados() {
        // Carga los resultados detallados por semana
        const semanaSeleccionada = resultadosSelect.value;
        const listaResultados = resultados[semanaSeleccionada] || [];
        
        resultadosList.innerHTML = "";

        if (listaResultados.length === 0) {
            resultadosList.innerHTML = `<p>Aún no hay resultados cargados para la Semana ${semanaSeleccionada}.</p>`;
            return;
        }

        listaResultados.forEach(res => {
            const { equipo1, score1, equipo2, score2 } = res;
            
            const ganador1 = score1 > score2;
            const ganador2 = score2 > score1;

            const resultadoDiv = document.createElement("div");
            resultadoDiv.classList.add("partido-resultado");
            
            resultadoDiv.innerHTML = `
                <div class="equipo-res" style="color: ${ganador1 ? '#2563eb' : '#1f2937'};">
                    <img class="logo-res" src="${logos[equipo1]}" alt="${equipo1}">
                    ${equipo1}
                </div>
                <div class="score" style="color: ${ganador1 ? '#2563eb' : '#6b7280'};">${score1}</div>
                <div class="vs-res">-</div>
                <div class="score" style="color: ${ganador2 ? '#2563eb' : '#6b7280'};">${score2}</div>
                <div class="equipo-res" style="color: ${ganador2 ? '#2563eb' : '#1f2937'};">
                    ${equipo2}
                    <img class="logo-res" src="${logos[equipo2]}" alt="${equipo2}">
                </div>
            `;
            resultadosList.appendChild(resultadoDiv);
        });
    }
    
    function calcularRendimientoEquipos() {
        const records = {};
        Object.keys(logos).forEach(equipo => {
            records[equipo] = { G: 0, P: 0 };
        });

        Object.values(resultados).flat().forEach(res => {
            const { equipo1, score1, equipo2, score2 } = res;

            if (score1 > score2) {
                records[equipo1].G += 1;
                records[equipo2].P += 1;
            } else if (score2 > score1) {
                records[equipo2].G += 1;
                records[equipo1].P += 1;
            }
        });

        const recordsArray = Object.keys(records).map(equipo => ({
            equipo: equipo,
            G: records[equipo].G,
            P: records[equipo].P,
        }));
        
        recordsArray.sort((a, b) => {
            if (b.G !== a.G) {
                return b.G - a.G; 
            }
            return a.P - b.P; 
        });

        recordsTableBody.innerHTML = "";
        recordsArray.forEach(record => {
            if (record.G + record.P > 0) {
                const fila = document.createElement("tr");
                fila.innerHTML = `
                    <td>
                        <img class="logo-res" src="${logos[record.equipo]}" alt="${record.equipo}" style="margin-right: 5px;">
                        ${record.equipo}
                    </td>
                    <td>${record.G}</td>
                    <td>${record.P}</td>
                `;
                recordsTableBody.appendChild(fila);
            }
        });
    }

    function guardarPronosticos() {
        const semanaSeleccionada = document.getElementById("semanaSelect").value;
        const nombreDelUsuario = nombreUsuarioInput.value.trim();
        const tabla = document.getElementById("tablaPronosticos");
        const tbody = tabla.querySelector("tbody");
        tbody.innerHTML = "";

        if (nombreDelUsuario === "") {
            alert("Por favor, introduce tu nombre antes de enviar los pronósticos.");
            nombreUsuarioInput.focus();
            return; 
        }

        // === CORRECCIÓN APLICADA AQUÍ ===
        // Generamos el HTML completo de la tabla para enviarlo, 
        // pero EmailJS se encargará de insertarlo y formatearlo correctamente.
        let resumenHTML = `
            <table>
                <thead>
                    <tr>
                        <th style="border: 1px solid #ddd; padding: 8px;">Partido</th>
                        <th style="border: 1px solid #ddd; padding: 8px;">Selección</th>
                    </tr>
                </thead>
                <tbody>
        `;

        const partidos = semanas[semanaSeleccionada];
        let todosPronosticados = true;
        
        partidos.forEach((par, i) => {
            const partidoId = `sem${semanaSeleccionada}_partido${i + 1}`;
            const seleccionado = document.querySelector(`input[name="${partidoId}"]:checked`);
            
            let equipoSeleccionado = "No seleccionado";
            if (seleccionado) {
                equipoSeleccionado = seleccionado.value;
            } else {
                todosPronosticados = false;
            }

            // Agrega la fila a la tabla local
            const filaLocal = document.createElement("tr");
            filaLocal.innerHTML = `
                <td>Semana ${semanaSeleccionada} - Partido ${i + 1}</td>
                <td>${equipoSeleccionado}</td>
            `;
            tbody.appendChild(filaLocal);

            // Agrega la fila al HTML del correo
            resumenHTML += `
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">Semana ${semanaSeleccionada} - Partido ${i + 1}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">${equipoSeleccionado}</td>
            </tr>
            `;
        });
        
        resumenHTML += `
                </tbody>
            </table>
        `;
        // ===================================

        tabla.style.display = "table";

        if (!todosPronosticados) {
            if (!confirm("Advertencia: No has pronosticado todos los partidos. ¿Deseas enviar los pronósticos incompletos?")) {
                return;
            }
        }
        
        emailjs.send("service_9lofljr", "template_g4bdg16", {
            nombre: nombreDelUsuario,
            semana: semanaSeleccionada,
            pronosticosHTML: resumenHTML
        }).then(
            function(response) {
            alert(`Pronósticos enviados por ${nombreDelUsuario} correctamente ✅`);
            },
            function(error) {
            alert("Error al enviar: " + JSON.stringify(error));
            }
        );
    }

    cargarSemana();
    cargarResultados();
    calcularRendimientoEquipos(); 
  </script>
</body>

</html>


